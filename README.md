# ubipong-rating-api

## Rating Organization

The basic data structure includes:

- *Player*, a player in the system, who has a rating

- *Tournament*, a set of matches played by a set of players, which would affect
the players' ratings.

- *PlayerRatingAdjustment*, represents a change in rating of a given Player. It
has a many-to-one relationship to a Player.

## Upload Rating Adjustment

Sometimes we need to adjust the ratings of Players without having the results
of a tournament.  To adjust the ratings, call the service

    POST http://{host}/rest/v0/rating/rating-adjustment
    Content-Type: text/csv

The request body is a csv file with the structure

    line 1                tournamentName       , {tournament name}
    line 2                date                 , {date, in ISO8601 format}
    line 3                player               , rating
    line 4                {player1_username}   , {player1_rating}
    line 5                {player2_username}   , {player2_rating}
    line 6                {player3_username}   , {player3_rating}
    ...and so on

This will create a PlayerRatingAdjustment for each player.  If the player
does not exist in the system, the service would return an error.  To allow
players to be added automatically, set the query parameter

    ?autoAddPlayer=true

The tournament name must be unique, or the service will return an error.

## Upload Tournament Result

A tournament result does not include a rating but can be combined with existing
ratings to create rating adjustments. To upload a tournament result, call the
service

    POST http://{host}/rest/v0/rating/tournament-result
    Content-Type: application/json

The request body is a JSON:

    {
        "tournamentName": tournamentName,
        "tournamentDate": tournamentDate in ISO8601 format,
        "tournamentResultList": [
            {
                "winner": winner's user name,
                "loser": loser's user name,
                "eventName": name of the event, such as u-1500 round robin group 1,
                "resultString": result of the match, which is usually a list of scores,
            },
            ... more results
        ]
    }

Usually the tournament result request body is generated by ubipong-api, so there
is no need to manually write this.  Just like the rating adjustment service, this
service will throw an error if the tournament name already exists.

For now, this service cannot automatically add players.  To submit a tournament 
result for a player who is not in the system, first submit a rating adjustment.

## Deploying to Heroku

If Java plugin has not been installed:

    heroku plugins:install java

If application does not yet exist on Heroku:

    heroku create --no-remote

Deploy:

    heroku deploy:jar target/my-app.jar --app ubipong-rating-api


